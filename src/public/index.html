<!DOCTYPE html>
<html> 
    <head>
        <title>InvestEd</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </head>
    <body>
        <!-- NAVIGATION BAR -->
        <div id="navbar"></div>

        <div class="container mt-4">
            <h1 class="fw-bold">Dashboard</h1>
        </div>

        <!-- PERFORMANCE INDICATORS -->
        <div class="container mt-4">
            <div class="row g-4">
                <div class="col-lg-3 col-md-6">
                    <div class="card">
                        <div class="card-body text-center">
                            <h6 class="card-title mb-3">Total Investment</h6>
                            <p class="card-text fs-3 fw-bold" id="totalInvestment">$0</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="card">
                        <div class="card-body text-center">
                            <h6 class="card-title mb-3">Portfolio Value</h6>
                            <p class="card-text fs-3 fw-bold" id="totalValue">$0</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="card">
                        <div class="card-body text-center">
                            <h6 class="card-title mb-3">Total Growth</h6>
                            <p class="card-text fs-3 fw-bold" id="totalGrowth">$0</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="card">
                        <div class="card-body text-center">
                            <h6 class="card-title mb-3">Growth Percentage</h6>
                            <p class="card-text fs-3 fw-bold" id="growthPercentage">0%</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- OVERVIEW GRAPH -->
        <div class="container mt-4">
            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card position-relative">
                        <canvas id="portfolioChart" style="height: 624px"></canvas>
                        <div class="position-absolute end-0 p-2">
                            <div class="dropdown">
                                <select class="form-select-sm" id="timeframeGraph"> 
                                    <option value="1w">1W</option>
                                    <option value="1m">1M</option>
                                    <option value="6m">6M</option>
                                    <option value="1y" selected>1Y</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card">
                        <canvas id="stockPieChart" style="height: 300px"></canvas>
                    </div>
        
                    <div class="card mt-4">
                        <canvas id="sectorPieChart" style="height: 300px"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Owned Stocks List -->
        <div class="container mt-4 mb-4">
            <div class="card">
                <h5 class="card-header">Owned Stocks</h5>
                <div class="card-body">

                    <table class="table">
                        <thead>
                          <tr>
                            <th scope="col" class="text-center">Company Name</th>
                            <th scope="col" class="text-center">Symbol</th>
                            <th scope="col" class="text-center">Shares Owned</th>
                            <th scope="col" class="text-center">Current Price</th>
                            <th scope="col" class="text-center">Total Value</th>
                            <th scope="col" class="text-center"></th>
                          </tr>
                        </thead>
                        <tbody id = "stockTable">
                        </tbody>
                      </table>


                  <a href="#" class="btn btn-primary" id="viewAllStock">View All</a>
                </div>
              </div>
        </div>
        
            

        <!-- INSERT NAV BAR -->
        <script>
            fetch('./navBar.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('navbar').innerHTML = data;

                    // HIGHLIGHT ACTIVE BUTTON
                    let currentPath = window.location.pathname.split('/').pop();
                    if (currentPath === '') {
                        currentPath = 'index.html';
                    }

                    const navLinks = document.querySelectorAll('.nav-link');
                    navLinks.forEach(link => {
                        if (link.getAttribute('href') === currentPath) {
                            link.classList.add('active');
                            link.setAttribute('aria-current', 'page');
                        } else {
                            link.classList.remove('active');
                            link.removeAttribute('aria-current');
                        }
                    });
                });
        </script>


        <!-- FETCH PERFORMANCE STATS -->
        <script>
            fetch('./Dashboard/PerformanceIndicators')
                .then(response => response.json())
                .then(data => {
                    // Update performance indicators
                    document.getElementById('totalInvestment').textContent = `$${data.moneyIn.toLocaleString()}`;
                    document.getElementById('totalValue').textContent = `$${data.valuation.toLocaleString()}`;
                    document.getElementById('totalGrowth').textContent = `$${data.growthAbsolute.toLocaleString()}`;
                    document.getElementById('growthPercentage').textContent = `${data.growthPercent.toLocaleString()}%`;
                })
                .catch(error => console.error('Error fetching performance data:', error));
        </script>


        <!-- CHART SCRIPT -->
        <script>
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            
            let portfolioChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [
                        {
                            label: 'Portfolio',
                            data: [500, 1200, 1100, 1000, 2500, 3000, 5000, 4000, 4800, 5000, 5100, 6000],
                            borderWidth: 3
                        },
                        {
                            label: 'FTSE 100',
                            data: [1200, 1100, 1000, 900, 800, 700, 1600, 5200, 4200, 8300, 9000, 10000],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Portfolio Performance',
                            font: {
                                size: 20
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            align: 'end'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        
            // DYNAMIC TIMEFRAME UPDATE
            function updateChart(timeframe) {
                let newLabels, newPortfolioData, newFtseData;
        
                switch (timeframe) {
                    case '1w':
                        newLabels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
                        newPortfolioData = [250, 2542, 1233, 1200, 3411]; 
                        newFtseData = [3225, 2344, 2344, 1230, 1000];
                        break;
                    case '1m':
                        newLabels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                        newPortfolioData = [100, 450, 300, 500];
                        newFtseData = [1000, 750, 800, 1200];
                        break;
                    case '6m':
                        newLabels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
                        newPortfolioData = [500, 1200, 1100, 1000, 2500, 3000];
                        newFtseData = [1200, 1100, 1000, 900, 800, 700];
                        break;
                    case '1y':
                        newLabels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                        newPortfolioData = [500, 1200, 1100, 1000, 2500, 3000, 5000, 4000, 4800, 5000, 5100, 6000];
                        newFtseData = [1200, 1100, 1000, 900, 800, 700, 1600, 5200, 4200, 8300, 9000, 10000];
                        break;
                    default:
                        return;      
                }
        
                portfolioChart.data.labels = newLabels;
                portfolioChart.data.datasets[0].data = newPortfolioData;
                portfolioChart.data.datasets[1].data = newFtseData;
                portfolioChart.update();
            }
        
            document.getElementById('timeframeGraph').addEventListener('change', function() {
                const selectedTimeframe = this.value;
                updateChart(selectedTimeframe);
            });
        </script>

        
        <!-- OWNED STOCKS LIST -->
        <script>
            document.addEventListener("DOMContentLoaded", function () {

                const maxVisibleStocks = 3;
                const stockTableBody = document.getElementById("stockTable");
                const viewAllBtn = document.getElementById("viewAllStock");
                let showingAll = false;
        
                const userId = "1"; 
                const date = "2024-08-26"; 
        
                function renderTable(stocks, showAll = false) {
                    stockTableBody.innerHTML = "";
                    const stocksToShow = showAll ? stocks.length : Math.min(stocks.length, maxVisibleStocks);
        
                    if (stocks.length === 0) {
                        const row = `
                            <tr>
                                <th colspan="6" class="text-center">No Stocks Owned</th>
                            </tr>
                        `;
                        stockTableBody.insertAdjacentHTML('beforeend', row);
                        viewAllBtn.style.display = 'none';
                        return;
                    }
        
                    for (let i = 0; i < stocksToShow; i++) {
                        const stock = stocks[i];
                        const row = `
                            <tr>
                                <td scope="row" class="text-center">${stock.stock_name}</td>
                                <th class="text-center">${stock.ticker}</th>
                                <td class="text-center">${stock.totalShares}</td>
                                <td class="text-center">${stock.currentPrice}</td>
                                <td class="text-center">${stock.marketValue}</td>
                                <td class="text-center"><a href="#" class="btn btn-primary">Details</a></td>
                            </tr>
                        `;
                        stockTableBody.insertAdjacentHTML('beforeend', row);
                    }
        
                    viewAllBtn.textContent = showAll ? "View Less" : "View All";
                    viewAllBtn.style.display = stocks.length <= maxVisibleStocks ? 'none' : 'block';
                }
        
                fetch(`./Dashboard/GetAll?userId=${userId}&date=${date}`)
                    .then(response => {
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        return response.json();
                    })
                    .then(data => {
                        stockData = data;
                        renderTable(stockData.stocks);
                    })
                    .catch(error => console.error('Error fetching performance data:', error));
        
                viewAllBtn.addEventListener("click", function (e) {
                    e.preventDefault();
                    showingAll = !showingAll;
                    renderTable(stockData.stocks, showingAll);
                });
            });
        </script>
        

        <!-- STOCK PIE CHARTS -->

        <script>
            const stockPieData = {
                labels: ['AAPL', 'GOOGL', 'MSFT', 'AMZN', 'Other'],
                datasets: [{
                    data: [30, 25, 20, 15, 10]
                }]
            };
        
            const stockPieCtx = document.getElementById('stockPieChart').getContext('2d');
            const stockPieChart = new Chart(stockPieCtx, {
                type: 'doughnut',
                data: stockPieData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Your Top Stocks',
                            font: {
                                size: 15
                            }
                        },
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    }
                }
            });
        </script>
        
        <!-- SECTOR PIE CHART -->
        <script>
            const sectorData = {
                labels: ['Technology', 'Healthcare', 'Finance', 'Energy', 'Other'],
                datasets: [{
                    data: [40, 30, 15, 10, 5]
                }]
            };
        
            const sectorPieCtx = document.getElementById('sectorPieChart').getContext('2d');
            const sectorPieChart = new Chart(sectorPieCtx, {
                type: 'doughnut',
                data: sectorData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Your Portfolio Sectors',
                            font: {
                                size: 15
                            }
                        },
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    }
                }
            });
        </script>
        
        
        
        


        <!-- BOOTSTRAP SCRIPT -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>      
    </body>
</html>
