<!-- public/browse.html -->
<!DOCTYPE html>
<html> 
    <head>
        <title>InvestEd Browse</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    </head>

    <body>
        <div id="navbar"></div>
        <h1> </h1>


        <script>
            // Fetch the navigation bar
            fetch('./navBar.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('navbar').innerHTML = data;

                    // After inserting the navbar, execute the code to highlight the active link
                    const currentPath = window.location.pathname.split('/').pop();

                    const navLinks = document.querySelectorAll('.nav-link');
                    navLinks.forEach(link => {
                        if (link.getAttribute('href') === currentPath) {
                            link.classList.add('active');
                            link.setAttribute('aria-current', 'page');
                        } else {
                            link.classList.remove('active');
                            link.removeAttribute('aria-current');
                        }
                    });
                });

                async function fetchWatchlist() {
        try {
            const response = await fetch('http://localhost:3000/Browse/watchlist');
            const data = await response.json();
            const watchlistItems = document.getElementById('watchlistItems');
            const additionalWatchlistItems = document.getElementById('additionalWatchlistItems');

            data.forEach((item, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'list-group-item';

                listItem.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span>${item.name} (${item.ticker})</span>
                            <span class="badge bg-primary badge-pill ms-2">$${item.current_price}</span>
                            <span class="badge bg-secondary ms-2">${item.growth_today}%</span>
                        </div>
                        <div class="mt-2">
                            <button class="btn btn-sm btn-outline-primary me-2" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDetail${item.id}" aria-expanded="false" aria-controls="collapseDetail${item.id}" onclick="showStockDetail('${item.ticker}', ${item.id})">View Detail</button>
                            <button class="btn btn-sm btn-outline-danger" onclick="removeFromWatchlist(${item.id}, this)">Remove</button>
                        </div>
                    </div>
                    <div class="collapse mt-2" id="collapseDetail${item.id}">
                        <div class="card card-body" id="detailContent${item.id}">
                            <p>Loading details...</p>
                        </div>
                    </div>
                `;

                // Display the first 3 items by default, and the rest in the collapsible section
                if (index < 3) {
                    watchlistItems.appendChild(listItem);
                } else {
                    additionalWatchlistItems.appendChild(listItem);
                }
            });
        } catch (error) {
            console.error('Error fetching watchlist:', error);
        }
    }
    // Function to get company profile from your backend
    async function getCompanyProfile(ticker) {
        try {
            const response = await fetch(`http://localhost:3000/Stockinfo/Companyinfo?ticker=${ticker}`);
            if (!response.ok) {
                throw new Error(`Failed to fetch company profile for ${ticker}`);
            }
            const data = await response.json();
            return data.CompanyInfo; // Access the CompanyInfo object directly
        } catch (error) {
            console.error(`Error fetching company profile for ${ticker}:`, error);
            throw error;  // Re-throw the error if you want to handle it later
        }
    }

    // Function to show stock details in the dropdown
    async function showStockDetail(ticker, id) {
        const detailContent = document.getElementById(`detailContent${id}`);
        try {
            const profile = await getCompanyProfile(ticker);
            detailContent.innerHTML = `
                <p><strong>Company Name:</strong> ${profile.name}</p>
                <p><strong>Ticker:</strong> ${profile.ticker}</p>
                <p><strong>Country:</strong> ${profile.country}</p>
                <p><strong>Exchange:</strong> ${profile.exchange}</p>
                <p><strong>Phone:</strong> ${profile.phone}</p>
                <p><strong>Website:</strong> <a href="${profile.weburl}" target="_blank">${profile.weburl}</a></p>
            `;
        } catch (error) {
            detailContent.innerHTML = `<p>Error loading company details. Please try again later.</p>`;
        }
    }

    // Function to remove a stock from the watchlist
    async function removeFromWatchlist(watchID, buttonElement) {
        try {
            const response = await fetch(`http://localhost:3000/Browse/watchlist/delete?watchID=${watchID}`, {
                method: 'DELETE',
            });

            if (response.ok) {
                const listItem = buttonElement.closest('.list-group-item');
                listItem.remove();
            } else {
                console.error('Failed to remove stock from watchlist');
            }
        } catch (error) {
            console.error('Error removing stock from watchlist:', error);
        }
    }

    // Fetch the watchlist when the page loads
    document.addEventListener('DOMContentLoaded', fetchWatchlist);
</script>

<!-- Watchlist Section -->
<div class="container mt-4 d-flex justify-content-center">
    <div class="col-lg-6 col-md-8 col-sm-12">
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4>Watchlist</h4>
                <div>
                    <button class="btn btn-link" type="button" data-bs-toggle="collapse" data-bs-target="#watchlistCollapse" aria-expanded="false" aria-controls="watchlistCollapse">
                        View All
                    </button>
                </div>
            </div>
            <ul class="list-group list-group-flush" id="watchlistItems">
                <!-- Watchlist items will be populated here dynamically -->
            </ul>
            <div id="watchlistCollapse" class="collapse">
                <ul class="list-group list-group-flush" id="additionalWatchlistItems">
                    <!-- Additional watchlist items will be populated here dynamically -->
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS (necessary for collapse) -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>











    
        <div class="container mt-4 d-flex justify-content-center">
            <div class="col-lg-6 col-md-8 col-sm-12">
                <!-- TOP STOCK LIST -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h4>Top stock list</h4>
                        <div>
                            <button class="btn btn-link" type="button" data-bs-toggle="collapse" data-bs-target="#watchlistCollapse" aria-expanded="false" aria-controls="watchlistCollapse">
                                View All
                            </button>
                        </div>
                    </div>
                    <ul class="list-group list-group-flush">
                        <!-- Top 3 items displayed by default -->
                        <li class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span>Apple Inc. (AAPL)</span>
                                    <span class="badge bg-primary badge-pill ms-2">$150.75</span>
                                </div>
                                <div class="mt-2">
                                    <button class="btn btn-sm btn-outline-primary me-2">View Detail</button>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span>Tesla Inc. (TSLA)</span>
                                    <span class="badge bg-primary badge-pill">$675.50</span>
                                </div>
                                <div class="mt-2">
                                    <button class="btn btn-sm btn-outline-primary me-2">View Detail</button>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span>Amazon.com Inc. (AMZN)</span>
                                    <span class="badge bg-primary badge-pill">$3,212.90</span>
                                </div>
                                <div class="'mt-2">
                                <button class="btn btn-sm btn-outline-primary me-2">View Detail</button>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <!-- Collapse for additional items -->
                    <div id="watchlistCollapse" class="collapse">
                        <ul class="list-group list-group-flush">
                            <!-- Additional items hidden by default  -->
                            <li class="list-group-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <span>Alphabet Inc. (GOOGL)</span>
                                        <span class="badge bg-primary badge-pill">$2,834.50</span>
                                    </div>
                                    <div class="mt-2">
                                        <button class="btn btn-sm btn-outline-primary me-2">View Detail</button>
                                    </div>
                                </div>
                            </li>
                            <!-- Add more items as needed -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Bootstrap JS (necessary for collapse) -->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    
 














    
        <div class="container mt-4 d-flex justify-content-center">
            <div class="col-lg-6 col-md-8 col-sm-12">
                <!-- WORST STOCK LIST -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h4>Worst stock list</h4>
                        <div>
                            <button class="btn btn-link" type="button" data-bs-toggle="collapse" data-bs-target="#watchlistCollapse" aria-expanded="false" aria-controls="watchlistCollapse">
                                View All
                            </button>
                        </div>
                    </div>
                    <ul class="list-group list-group-flush">
                        <!-- Top 3 items displayed by default -->
                        <li class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span>Apple Inc. (AAPL)</span>
                                    <span class="badge bg-primary badge-pill ms-2">$150.75</span>
                                </div>
                                <div class="mt-2">
                                    <button class="btn btn-sm btn-outline-primary me-2">View Detail</button>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span>Tesla Inc. (TSLA)</span>
                                    <span class="badge bg-primary badge-pill">$675.50</span>
                                </div>
                                <div class="mt-2">
                                    <button class="btn btn-sm btn-outline-primary me-2">View Detail</button>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span>Amazon.com Inc. (AMZN)</span>
                                    <span class="badge bg-primary badge-pill">$3,212.90</span>
                                </div>
                                <div class="'mt-2">
                                <button class="btn btn-sm btn-outline-primary me-2">View Detail</button>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <!-- Collapse for additional items -->
                    <div id="watchlistCollapse" class="collapse">
                        <ul class="list-group list-group-flush">
                            <!-- Additional items hidden by default  -->
                            <li class="list-group-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <span>Alphabet Inc. (GOOGL)</span>
                                        <span class="badge bg-primary badge-pill">$2,834.50</span>
                                    </div>
                                    <div class="mt-2">
                                        <button class="btn btn-sm btn-outline-primary me-2">View Detail</button>
                                    </div>
                                </div>
                            </li>
                            <!-- Add more items as needed -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Bootstrap JS (necessary for collapse) -->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    
 
</body>






</html>